<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4"
        crossorigin="anonymous"></script>
    <script src="tree.js"></script>
</head>
<style>
    .toggle-icon {
        display: inline;
        margin-left: -12px;
    }
    .nav-list {
        margin-left: -1.5rem;
    }
</style>
<body>
    <div class="container mt-3 ml-1">
        <div class="card">
            <div class="card-body">
                <ul id="tree" class="nav"></ul>
            </div>
        </div>
    </div>
</body>
<script>
    let depth = 1;
    let markup = '';

    $(document).ready(function () {
        print_node(tree);
        $('#tree').append(markup);

        $('.toggle-icon').on('click', function () {
            $(this).toggleClass('fa-plus');
            $(this).toggleClass('fa-minus');
        });
    });



    function print_node(node){
        Object.keys(node).forEach(function (key) {
            print_key(node, key);
        });
    }

    function print_key(node, key){
        if(key == 'link'){
            let current_depth = node[key].depth;
            let has_children = node[key].has_children;
            let active_trail = node[key].in_active_trail ? " class='nav-item nav-item--active-trail'" : "";
            let toggle_icon = node[key].in_active_trail ? 'fa-minus' : 'fa-plus';
            let expanded = active_trail ? 'show' : '';
            let nid = node[key].nid;

            // let title = active_trail ? "<b>" + node[key].title + "</b>" : node[key].title;
            let title = node[key].title;

            if(current_depth < depth){
                markup += "</li></ul>".repeat(depth - current_depth);
            }

            markup += "<li"+active_trail+" class='nav-item' style='list-style-type:none'>";

            if(has_children == "1"){
                markup += "<a data-toggle='collapse' href='#nav-trail-" + nid + "' class='toggle-icon fa " + toggle_icon + "'></a>";
            }

            // @TODO: Convert node id to aliased version.
            // $alias = \Drupal::service('path.alias_manager')->getAliasByPath('/node/'.$nid);
            markup += "<a href='https://newonlinecourses.science.psu.edu/stat200/node/" + nid + "' class='nav-link d-inline'>" + title + "</a>";

            if (has_children == "1") {
                markup += "<ul id='nav-trail-" + nid + "' class='nav-list collapse "+expanded+"' >";
            } else {
                markup += "</li>";
            }

            depth = current_depth;

        } else {
            print_node(node[key]);
        }

    }
</script>
</html>